<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, February 27, 2024, 5:56 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Scriber" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Scriber"
   author="Hiballl"
   id="834cb329fa560f75ec850181"
   language="Lua"
   purpose="Scroll scriber plugin"
   save_state="y"
   date_written="2024-02-27 17:54:45"
   requires="5.07"
   version="1.0"
   >

</plugin>


<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   expand_variables="y"
   group="Scriber"
   match="The magic enchantment has failed --- the scroll vanishes."
   send_to="12"
   sequence="100"
  >
  <send>Execute("scriber " ..GetVariable("ScribeSpellName"))</send>
  </trigger>
  <trigger
   enabled="y"
   expand_variables="y"
   group="Scriber"
   match="You buy * a blank scroll from Mayvor, master of mystic permeations for * gold."
   send_to="12"
   sequence="100"
  >
  <send>Send("put all.scroll " ..GetVariable("ScribeBlankScrollBag"))</send>
  </trigger>
  <trigger
   enabled="y"
   expand_variables="y"
   group="Scriber"
   match="You have imbued a new spell to the scroll."
   send_to="12"
   sequence="100"
  >
  <send>SetVariable ("ScribeSpellCount", tonumber (GetVariable ("ScribeSpellCount")) + 1)
Execute("evaluateScribe")</send>
  </trigger>
  <trigger
   enabled="y"
   expand_variables="y"
   group="Scriber"
   match="You lost your concentration while trying to scribe the new magic."
   send_to="12"
   sequence="100"
  >
  <send>Send("scribe " ..GetVariable("ScribeSpellName"))</send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="^scriber( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local vItem = Trim("%1")

if vItem == '-help' then
      Note("***************** Scriber Help *****************")
      Note("** Commands:                                   *")
	  Note("*                                              *")
	  Note("resetScribeVariables - Reset some variables.   *")
	  Note("*                                              *")
	  Note("scriber - Command to scribe scroll.            *")
	  Note("*                                              *")
	  Note("scriber buy - Go buy some scrolls.             *")
	  Note("*                                              *")
	  Note("scriber -help - This help screen.              *")
	  Note("*                                              *")
	  Note("scriber -info - List of scriber variables.     *")
	  Note("*                                              *")
	  Note("setBlankScrollBag - Bag for blank scrolls.     *")
	  Note("*                                              *")
	  Note("setHoldItem - To track your normal hold item.  *")
	  Note("*                                              *")
	  Note("setScrollBag - Bag for completed scrolls.      *")
	  Note("*                                              *")
	  Note("setScrollBuyCount - How many blank scrolls to  *")
	  Note("                     buy at a time.            *")
	  Note("*                                              *")
	  Note("setScrollSpellCount - How many spells added    *")
	  Note("                       to a scroll.            *")
	  Note("************************************************")

elseif vItem == '-info' then
      Note("***************** Scriber Info *****************")
	  Note("** Variables:                                  *")
      Note(" ScribeScrollBuyNumber: " ..GetVariable("ScribeScrollBuyNumber"))
	  Note(" ScribeScrollBag:       " ..GetVariable("ScribeScrollBag"))
	  Note(" ScribeSpellName:      " ..GetVariable("ScribeSpellName"))
	  Note(" ScribeSpellsRequired: " ..GetVariable("ScribeSpellsRequired"))
	  Note(" ScribeBlankScrollBag:  " ..GetVariable("ScribeBlankScrollBag"))
	  Note(" ScribeHoldItem:        " ..GetVariable("ScribeHoldItem"))
      Note("************************************************")
elseif vItem == 'buy' then

      Execute("mapper goto 32467")
      Send("buy " ..GetVariable("ScribeScrollBuyNumber") .. " 1")

else

      Execute("resetScribeVariables")
      Send("take scroll " ..GetVariable("ScribeBlankScrollBag"))
      Send("hold scroll")
      SetVariable ("ScribeSpellName",vItem)
      Send("scribe " ..vItem)

end
</send>
  </alias>
  <alias
   match="^rincon$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>Send("take incompletehealing " ..GetVariable("ScribeScrollBag"))
Send("recite incompletehealing")</send>
  </alias>
  <alias
   match="^setScrollSpellCount( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local NewBag = Trim("%1")
SetVariable ("ScribeSpellsRequired",NewBag)
Note ("Number of Spells now set to: " ..NewBag)</send>
  </alias>
  <alias
   match="^setScrollBag( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local NewBag = Trim("%1")
SetVariable ("ScribeScrollBag",NewBag)
Note ("Scroll Bag now set to: " ..NewBag)</send>
  </alias>
  <alias
   match="^resetScribeVariables$"
   enabled="y"
   regexp="y"
   group="Scriber"
   script="resetScribeVars"
   sequence="100"
  >
  </alias>
  <alias
   match="^setBlankScrollBag( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local NewBag = Trim("%1")
SetVariable ("ScribeBlankScrollBag",NewBag)
Note ("Blank Scroll Bag now set to: " ..NewBag)</send>
  </alias>
  <alias
   match="^setHoldItem( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local NewBag = Trim("%1")
SetVariable ("ScribeHoldItem",NewBag)
Note ("Hold Item now set to: " ..NewBag)</send>
  </alias>
  <alias
   match="^setScrollBuyCount( .*){0,1}$"
   enabled="y"
   expand_variables="y"
   group="Scriber"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>local NewBag = Trim("%1")
SetVariable ("ScribeScrollBuyNumber",NewBag)
Note ("Scroll Buy Number now set to: " ..NewBag)</send>
  </alias>
  <alias
   match="^evaluateScribe$"
   enabled="y"
   regexp="y"
   group="Scriber"
   script="evalScroll"
   sequence="100"
  >
  </alias>
</aliases>

<!--  Variables  -->

<variables>
  <variable name="ScribeScrollBuyNumber">20</variable>
  <variable name="ScribeScrollBag">None</variable>
  <variable name="ScribeSpellCount">0</variable>
  <variable name="ScribeSpellName">None</variable>
  <variable name="ScribeSpellsRequired">3</variable>
  <variable name="ScribeBlankScrollBag">None</variable>
  <variable name="ScribeHoldItem">None</variable>
</variables>

<!--  Script  -->
<script>

	function resetScribeVars()
		SetVariable("ScribeSpellName", "None")
		SetVariable("ScribeSpellCount", '0')
	end

	function evalScroll()
		local spellCountRequired = Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellsRequired"))
		local currentSpellCount = Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellCount"))
		
		if currentSpellCount == '1' then
			Note("#1")
			if currentSpellCount ~= spellCountRequired then
				Send("scribe " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellName")))
			else
				SendNoEcho("hold " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeHoldItem")))
				SendNoEcho("keep scroll")
				SendNoEcho("put scroll " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeScrollBag")))
				resetScribeVars()
			end
		elseif currentSpellCount == '2' then
			Note("#2")
			if currentSpellCount ~= spellCountRequired then
				Send("scribe " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellName")))
			else
				SendNoEcho("hold " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeHoldItem")))
				SendNoEcho("keep scroll")
				SendNoEcho("put scroll " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeScrollBag")))
				resetScribeVars()
			end
		elseif currentSpellCount == '3' then
			Note("#3")
			if currentSpellCount ~= spellCountRequired then
				Send("scribe " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellName")))
			else
				SendNoEcho("hold " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeHoldItem")))
				SendNoEcho("keep scroll")
				SendNoEcho("put scroll " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeScrollBag")))
				resetScribeVars()
			end
		elseif currentSpellCount == '4' then
			Note("#4")
			if currentSpellCount ~= spellCountRequired then
				Send("scribe " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeSpellName")))
			else
				SendNoEcho("hold " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeHoldItem")))
				SendNoEcho("keep scroll")
				SendNoEcho("put scroll " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeScrollBag")))
				resetScribeVars()
			end
		elseif currentSpellCount == '5' then
			Note("#5")
			SendNoEcho("hold " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeHoldItem")))
			SendNoEcho("keep scroll")
			SendNoEcho("put scroll " ..Trim(GetPluginVariable ("834cb329fa560f75ec850181","ScribeScrollBag")))
			resetScribeVars()
		end
	end
</script>
</muclient>
